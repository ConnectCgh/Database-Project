<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¾å®¢ä¸­å¿ƒ - SpeedEats</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 250px;
            background-color: #161b22;
            border-right: 1px solid #21262d;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #21262d;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .logo-icon::before {
            content: "ğŸ”";
            font-size: 24px;
            filter: grayscale(1) brightness(0.2);
        }

        .logo-text {
            color: #ffc107;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 1px;
        }

        .customer-info {
            padding: 0 20px 20px;
            border-bottom: 1px solid #21262d;
            margin-bottom: 20px;
        }

        .customer-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .customer-status {
            font-size: 12px;
            color: #8b949e;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #c9d1d9;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .nav-link.active {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border-left-color: #ffc107;
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #21262d;
        }

        .page-title {
            font-size: 24px;
            font-weight: 300;
            color: #f0f6fc;
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .user-name {
            margin-right: 15px;
        }

        .logout-btn {
            background-color: transparent;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background-color: rgba(248, 81, 73, 0.1);
            border-color: #f85149;
            color: #f85149;
        }

        /* å†…å®¹å¡ç‰‡æ ·å¼ */
        .content-card {
            background-color: #161b22;
            border: 1px solid #21262d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #21262d;
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: #f0f6fc;
        }

        .btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            background-color: #ffc107;
            color: #0d1117;
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background-color: #ffca2c;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background-color: rgba(248, 81, 73, 0.1);
            color: #f85149;
            border-color: #f85149;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            border: 1px solid;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-danger:hover {
            background-color: rgba(248, 81, 73, 0.2);
        }

        .btn-secondary {
            background-color: #21262d;
            color: #c9d1d9;
            border-color: #30363d;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            border: 1px solid;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
        }

        .btn-secondary:hover {
            background-color: #30363d;
        }

        .btn-success {
            background-color: rgba(63, 185, 80, 0.1);
            color: #3fb950;
            border-color: #3fb950;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            border: 1px solid;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
        }

        .btn-success:hover {
            background-color: rgba(63, 185, 80, 0.2);
        }

        /* æœç´¢ç­›é€‰æ ·å¼ */
        .search-filter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-input, .filter-select {
            padding: 8px 12px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }

        .filter-input:focus, .filter-select:focus {
            border-color: #ffc107;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.3);
        }

        /* å•†å®¶å¡ç‰‡æ ·å¼ */
        .merchant-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
        }

        .merchant-card {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 16px;
            transition: all 0.2s;
        }

        .merchant-card:hover {
            border-color: #ffc107;
            transform: translateY(-2px);
        }

        .merchant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .merchant-name {
            font-weight: 500;
            color: #f0f6fc;
            font-size: 16px;
        }

        .merchant-platforms {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .platform-tag {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .merchant-info-details {
            margin-bottom: 12px;
        }

        .merchant-phone, .merchant-address {
            font-size: 12px;
            color: #8b949e;
            margin-bottom: 4px;
        }

        .merchant-platforms-list {
            margin-top: 12px;
        }

        .merchant-platform-item {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .merchant-platform-item:hover {
            border-color: #ffc107;
        }

        .platform-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .platform-name {
            font-weight: 500;
            color: #ffc107;
            font-size: 14px;
        }

        .platform-meal-count {
            font-size: 12px;
            color: #8b949e;
        }

        .merchant-meals {
            margin-top: 8px;
        }

        .meal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #21262d;
        }

        .meal-item:last-child {
            border-bottom: none;
        }

        .meal-name {
            font-size: 14px;
        }

        .meal-price {
            font-size: 14px;
            color: #ffc107;
        }

        .meal-type {
            font-size: 11px;
            color: #8b949e;
            margin-left: 8px;
        }

        /* å•†å®¶è¯¦æƒ…æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(13, 17, 23, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: #161b22;
            border: 1px solid #21262d;
            border-radius: 6px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #21262d;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 500;
            color: #f0f6fc;
        }

        .close-btn {
            background: none;
            border: none;
            color: #8b949e;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #f0f6fc;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #21262d;
        }

        .total-price {
            font-size: 18px;
            font-weight: 500;
            color: #ffc107;
        }

        /* é¤å“é€‰æ‹©æ ·å¼ */
        .meal-selection {
            margin-bottom: 20px;
        }

        .meal-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #30363d;
            border-radius: 6px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .meal-option:hover {
            border-color: #ffc107;
        }

        .meal-option.selected {
            border-color: #ffc107;
            background-color: rgba(255, 193, 7, 0.1);
        }

        .meal-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .meal-checkbox {
            width: 18px;
            height: 18px;
        }

        .meal-details {
            flex: 1;
        }

        .meal-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            background-color: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background-color: #30363d;
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #c9d1d9;
            padding: 4px;
        }

        /* æŠ˜æ‰£é€‰æ‹©æ ·å¼ */
        .discount-selection {
            margin-bottom: 20px;
        }

        .discount-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .discount-option {
            padding: 8px 12px;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .discount-option:hover {
            border-color: #ffc107;
        }

        .discount-option.selected {
            border-color: #ffc107;
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }

        th {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            font-weight: 500;
        }

        tr:hover {
            background-color: rgba(255, 193, 7, 0.05);
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-unassigned {
            background-color: rgba(248, 81, 73, 0.1);
            color: #f85149;
        }

        .status-assigned {
            background-color: rgba(45, 164, 255, 0.1);
            color: #2da4ff;
        }

        .status-ready {
            background-color: rgba(63, 185, 80, 0.1);
            color: #3fb950;
        }

        .status-completed {
            background-color: rgba(63, 185, 80, 0.1);
            color: #3fb950;
        }

        .status-cancelled {
            background-color: rgba(248, 81, 73, 0.1);
            color: #f85149;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .logo-text,
            .sidebar .customer-name,
            .sidebar .customer-status,
            .sidebar .nav-link span {
                display: none;
            }

            .sidebar .logo {
                padding: 0 10px 20px;
            }

            .sidebar .nav-link {
                justify-content: center;
                padding: 12px 10px;
            }

            .sidebar .nav-icon {
                margin-right: 0;
            }

            .main-content {
                margin-left: 70px;
            }

            .search-filter {
                grid-template-columns: 1fr;
            }

            .merchant-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <form style="display: none;">{% csrf_token %}</form>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon"></div>
                <div class="logo-text">SpeedEats</div>
            </div>

            <div class="customer-info">
                <div class="customer-name">{{ customer_name }}</div>
                <div class="customer-status">é¡¾å®¢çŠ¶æ€ï¼šæ­£å¸¸</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-target="order-section">
                        <span class="nav-icon">ğŸ”</span>
                        <span>ç‚¹é¤ä¸‹å•</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-target="history-section">
                        <span class="nav-icon">ğŸ“¦</span>
                        <span>æˆ‘çš„è®¢å•</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <h1 class="page-title">é¡¾å®¢ä¸­å¿ƒ</h1>
                <div class="user-menu">
                    <span class="user-name">{{ customer_name }}</span>
                    <button class="logout-btn">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <!-- ç‚¹é¤ä¸‹å•éƒ¨åˆ† -->
            <div id="order-section" class="content-section">
                <div class="content-card">
                    <div class="card-header">
                        <h2 class="card-title">å•†å®¶åˆ—è¡¨</h2>
                    </div>

                    <!-- æœç´¢ç­›é€‰ -->
                    <div class="search-filter">
                        <div class="filter-group">
                            <label class="filter-label">å¹³å°</label>
                            <select class="filter-select" id="platform-filter">
                                <option value="">æ‰€æœ‰å¹³å°</option>
                                {% for platform in platforms %}
                                <option value="{{ platform.id }}">{{ platform.platform_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">å•†å®¶åç§°</label>
                            <input type="text" class="filter-input" id="merchant-filter" placeholder="æœç´¢å•†å®¶...">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">é¤å“åç§°</label>
                            <input type="text" class="filter-input" id="meal-filter" placeholder="æœç´¢é¤å“...">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">é¤å“ç±»å‹</label>
                            <select class="filter-select" id="meal-type-filter">
                                <option value="">æ‰€æœ‰ç±»å‹</option>
                                <option value="breakfast">æ—©é¤</option>
                                <option value="lunch">åˆé¤</option>
                                <option value="dinner">æ™šé¤</option>
                                <option value="lunch_and_dinner">åˆé¤å’Œæ™šé¤</option>
                            </select>
                        </div>
                    </div>

                    <!-- å•†å®¶å¡ç‰‡ -->
                    <div class="merchant-cards" id="merchant-cards-container">
                        {% for merchant_data in merchants_with_platforms %}
                        <div class="merchant-card">
                            <div class="merchant-header">
                                <div class="merchant-name">{{ merchant_data.merchant.merchant_name }}</div>
                                <div class="merchant-platforms">
                                    {% for platform in merchant_data.platforms %}
                                    <span class="platform-tag">{{ platform.platform_name }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="merchant-info-details">
                                <div class="merchant-phone">ç”µè¯: {{ merchant_data.merchant.phone }}</div>
                                <div class="merchant-address">åœ°å€: {{ merchant_data.merchant.address }}</div>
                            </div>

                            <div class="merchant-platforms-list">
                                {% for platform_data in merchant_data.platforms_with_meals %}
                                <div class="merchant-platform-item"
                                     data-merchant-id="{{ merchant_data.merchant.id }}"
                                     data-platform-id="{{ platform_data.platform.id }}">
                                    <div class="platform-header">
                                        <div class="platform-name">{{ platform_data.platform.platform_name }}</div>
                                        <div class="platform-meal-count">{{ platform_data.meals_count }} ä¸ªé¤å“</div>
                                    </div>
                                    <div class="merchant-meals">
                                        {% for meal in platform_data.meals|slice:":2" %}
                                        <div class="meal-item">
                                            <span class="meal-name">{{ meal.name }} <span class="meal-type">{{ meal.get_meal_type_display }}</span></span>
                                            <span class="meal-price">Â¥{{ meal.price }}</span>
                                        </div>
                                        {% endfor %}
                                        {% if platform_data.meals|length > 2 %}
                                        <div style="text-align: center; color: #8b949e; font-size: 12px; margin-top: 4px;">
                                            è¿˜æœ‰ {{ platform_data.meals|length|add:"-2" }} ä¸ªé¤å“...
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% empty %}
                        <div style="text-align: center; color: #8b949e; padding: 40px;">
                            æš‚æ— å•†å®¶ä¿¡æ¯
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- æˆ‘çš„è®¢å•éƒ¨åˆ† -->
            <div id="history-section" class="content-section" style="display: none;">
                <div class="content-card">
                    <div class="card-header">
                        <h2 class="card-title">æˆ‘çš„è®¢å•</h2>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>è®¢å•å·</th>
                                    <th>å•†å®¶</th>
                                    <th>å¹³å°</th>
                                    <th>é¤å“</th>
                                    <th>æ€»ä»·</th>
                                    <th>æŠ˜æ‰£</th>
                                    <th>éª‘æ‰‹</th>
                                    <th>çŠ¶æ€</th>
                                    <th>ä¸‹å•æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                {% for order in orders %}
                                <tr data-order-id="{{ order.id }}">
                                    <td>#{{ order.id }}</td>
                                    <td>{{ order.merchant.merchant_name }}</td>
                                    <td>{{ order.platform.platform_name }}</td>
                                    <td>{{ order.meal.name }}</td>
                                    <td>Â¥{{ order.price }}</td>
                                    <td>{% if order.discount %}{{ order.discount.discount_rate|floatformat:0 }}%{% else %}æ— {% endif %}</td>
                                    <td>{% if order.rider %}{{ order.rider.rider_name }}{% else %}æœªåˆ†é…{% endif %}</td>
                                    <td>
                                        <span class="status-badge status-{{ order.status }}">
                                            {{ order.get_status_display }}
                                        </span>
                                    </td>
                                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                                    <td>
                                        {% if order.status == 'ready' %}
                                        <button class="btn btn-success pickup-order-btn" data-order-id="{{ order.id }}">
                                            å–é¤
                                        </button>
                                        {% elif order.status in 'unassigned,cancelled' %}
                                        <button class="btn btn-danger delete-order-btn" data-order-id="{{ order.id }}">
                                            åˆ é™¤
                                        </button>
                                        {% else %}
                                        <span style="color: #8b949e; font-size: 12px;">ä¸å¯æ“ä½œ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="10" style="text-align: center;">æš‚æ— è®¢å•è®°å½•</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å•†å®¶è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="merchant-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-merchant-name">å•†å®¶è¯¦æƒ…</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 8px; color: #f0f6fc;">å•†å®¶ä¿¡æ¯</h4>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px 16px; font-size: 14px;">
                        <span style="color: #8b949e;">åç§°:</span>
                        <span id="detail-merchant-name"></span>
                        <span style="color: #8b949e;">ç”µè¯:</span>
                        <span id="detail-merchant-phone"></span>
                        <span style="color: #8b949e;">å¹³å°:</span>
                        <span id="detail-merchant-platform"></span>
                        <span style="color: #8b949e;">åœ°å€:</span>
                        <span id="detail-merchant-address"></span>
                    </div>
                </div>

                <div class="meal-selection">
                    <h4 style="margin-bottom: 12px; color: #f0f6fc;">é€‰æ‹©é¤å“</h4>
                    <div id="meal-options-container">
                        <!-- é¤å“é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <div class="discount-selection">
                    <h4 style="margin-bottom: 8px; color: #f0f6fc;">é€‰æ‹©æŠ˜æ‰£</h4>
                    <div class="discount-options" id="discount-options-container">
                        <!-- æŠ˜æ‰£é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="total-price" id="total-price-display">
                    æ€»è®¡: Â¥0.00
                </div>
                <button class="btn" id="place-order-btn">ç¡®è®¤ä¸‹å•</button>
            </div>
        </div>
    </div>

    <script>
    // å¯¼èˆªèœå•åˆ‡æ¢
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // æ›´æ–°æ´»åŠ¨èœå•é¡¹
            document.querySelectorAll('.nav-link').forEach(item => {
                item.classList.remove('active');
            });
            this.classList.add('active');

            // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹åŒºåŸŸ
            const targetId = this.getAttribute('data-target');
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(targetId).style.display = 'block';
        });
    });

    // è·å– CSRF token çš„å‡½æ•°
    function getCSRFToken() {
        const csrfTokenInput = document.querySelector('[name=csrfmiddlewaretoken]');
        if (csrfTokenInput) {
            return csrfTokenInput.value;
        }
        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°è¯•ä» cookie ä¸­è·å–
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // å…¨å±€å˜é‡å­˜å‚¨å½“å‰é€‰æ‹©çš„æŠ˜æ‰£å’Œå•†å®¶ä¿¡æ¯
    let selectedDiscount = { id: '', rate: 0 };
    let currentMerchantId = null;
    let currentPlatformId = null;

    // å•†å®¶å¹³å°æ¡ç›®ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', function(e) {
        // æ£€æŸ¥ç‚¹å‡»çš„æ˜¯å¦æ˜¯å¹³å°æ¡ç›®
        const platformItem = e.target.closest('.merchant-platform-item');
        if (platformItem) {
            currentMerchantId = platformItem.getAttribute('data-merchant-id');
            currentPlatformId = platformItem.getAttribute('data-platform-id');

            console.log(`ç‚¹å‡»å•†å®¶å¹³å°: merchant_id=${currentMerchantId}, platform_id=${currentPlatformId}`);

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const modal = document.getElementById('merchant-detail-modal');
            modal.style.display = 'flex';

            // è·å–å•†å®¶è¯¦æƒ…
            fetch(`/customer/get-merchant-detail/${currentMerchantId}/${currentPlatformId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMerchantDetail(data);
                    } else {
                        alert('è·å–å•†å®¶è¯¦æƒ…å¤±è´¥: ' + data.message);
                        modal.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
                    modal.style.display = 'none';
                });
        }
    });

    // æ˜¾ç¤ºå•†å®¶è¯¦æƒ…
    function displayMerchantDetail(data) {
        const merchant = data.merchant;
        const platform = data.platform;
        const meals = data.meals;
        const availableDiscounts = data.available_discounts || [];

        console.log(`æ˜¾ç¤ºå•†å®¶è¯¦æƒ…: ${merchant.merchant_name}, å¹³å°: ${platform.platform_name}, é¤å“æ•°é‡: ${meals.length}`);

        // æ›´æ–°å•†å®¶ä¿¡æ¯
        document.getElementById('modal-merchant-name').textContent = merchant.merchant_name;
        document.getElementById('detail-merchant-name').textContent = merchant.merchant_name;
        document.getElementById('detail-merchant-phone').textContent = merchant.phone;
        document.getElementById('detail-merchant-platform').textContent = platform.platform_name;
        document.getElementById('detail-merchant-address').textContent = merchant.address;

        // æ›´æ–°é¤å“é€‰é¡¹
        const mealContainer = document.getElementById('meal-options-container');
        mealContainer.innerHTML = '';

        if (meals.length === 0) {
            mealContainer.innerHTML = '<div style="text-align: center; color: #8b949e; padding: 20px;">æš‚æ— é¤å“</div>';
        } else {
            meals.forEach(meal => {
                const mealOption = document.createElement('div');
                mealOption.className = 'meal-option';
                mealOption.innerHTML = `
                    <div class="meal-info">
                        <input type="checkbox" class="meal-checkbox" data-meal-id="${meal.id}" data-meal-price="${meal.price}">
                        <div class="meal-details">
                            <div style="font-weight: 500;">${meal.name}</div>
                            <div style="font-size: 12px; color: #8b949e;">${getMealTypeDisplay(meal.meal_type)}</div>
                        </div>
                    </div>
                    <div class="meal-quantity">
                        <button class="quantity-btn minus-btn" data-meal-id="${meal.id}">-</button>
                        <input type="number" class="quantity-input" data-meal-id="${meal.id}" value="1" min="1" max="10">
                        <button class="quantity-btn plus-btn" data-meal-id="${meal.id}">+</button>
                        <div style="margin-left: 12px; color: #ffc107; font-weight: 500;">Â¥${meal.price}</div>
                    </div>
                `;
                mealContainer.appendChild(mealOption);
            });
        }

        // æ›´æ–°æŠ˜æ‰£é€‰é¡¹
        const discountContainer = document.getElementById('discount-options-container');
        discountContainer.innerHTML = '';

        // æ·»åŠ "æ— æŠ˜æ‰£"é€‰é¡¹
        const noDiscountOption = document.createElement('div');
        noDiscountOption.className = 'discount-option selected';
        noDiscountOption.setAttribute('data-discount-id', '');
        noDiscountOption.setAttribute('data-discount-rate', '0');
        noDiscountOption.textContent = 'æ— æŠ˜æ‰£';
        discountContainer.appendChild(noDiscountOption);

        // æ·»åŠ å¯ç”¨çš„æŠ˜æ‰£é€‰é¡¹
        availableDiscounts.forEach(discount => {
            const discountOption = document.createElement('div');
            discountOption.className = 'discount-option';
            discountOption.setAttribute('data-discount-id', discount.id);
            discountOption.setAttribute('data-discount-rate', discount.discount_rate);
            discountOption.textContent = discount.discount_display;
            discountContainer.appendChild(discountOption);
        });

        // é‡ç½®æ€»ä»·å’ŒæŠ˜æ‰£é€‰æ‹©
        selectedDiscount = { id: '', rate: 0 };
        updateTotalPrice();

        // æ·»åŠ é¤å“é€‰æ‹©äº‹ä»¶
        document.querySelectorAll('.meal-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const mealOption = this.closest('.meal-option');
                if (this.checked) {
                    mealOption.classList.add('selected');
                } else {
                    mealOption.classList.remove('selected');
                }
                updateTotalPrice();
            });
        });

        // æ·»åŠ æ•°é‡æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.plus-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const mealId = this.getAttribute('data-meal-id');
                const input = document.querySelector(`.quantity-input[data-meal-id="${mealId}"]`);
                input.value = parseInt(input.value) + 1;
                updateTotalPrice();
            });
        });

        document.querySelectorAll('.minus-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const mealId = this.getAttribute('data-meal-id');
                const input = document.querySelector(`.quantity-input[data-meal-id="${mealId}"]`);
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                    updateTotalPrice();
                }
            });
        });

        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', updateTotalPrice);
        });

        // é‡æ–°ç»‘å®šæŠ˜æ‰£é€‰æ‹©äº‹ä»¶
        document.querySelectorAll('.discount-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.discount-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');

                const discountId = this.getAttribute('data-discount-id');
                const discountRate = this.getAttribute('data-discount-rate');

                selectedDiscount = {
                    id: discountId === '' ? '' : discountId,
                    rate: parseFloat(discountRate) || 0
                };
                updateTotalPrice();
            });
        });
    }

    // è·å–é¤å“ç±»å‹æ˜¾ç¤ºæ–‡æœ¬
    function getMealTypeDisplay(mealType) {
        const typeMap = {
            'breakfast': 'æ—©é¤',
            'lunch': 'åˆé¤',
            'dinner': 'æ™šé¤',
            'lunch_and_dinner': 'åˆé¤å’Œæ™šé¤'
        };
        return typeMap[mealType] || mealType;
    }

    // æ›´æ–°æ€»ä»·
    function updateTotalPrice() {
        let total = 0;

        // è®¡ç®—é€‰ä¸­é¤å“çš„æ€»ä»·
        document.querySelectorAll('.meal-checkbox:checked').forEach(checkbox => {
            const mealId = checkbox.getAttribute('data-meal-id');
            const mealPrice = parseFloat(checkbox.getAttribute('data-meal-price'));
            const quantityInput = document.querySelector(`.quantity-input[data-meal-id="${mealId}"]`);
            const quantity = parseInt(quantityInput.value) || 1;

            total += mealPrice * quantity;
        });

        // åº”ç”¨æŠ˜æ‰£ - ä¿®æ­£ï¼šæŠ˜æ‰£ç‡ 0.3 è¡¨ç¤ºå‡å…30%ï¼Œå³æ”¯ä»˜70%
        if (selectedDiscount.rate > 0) {
            total = total * (1 - selectedDiscount.rate);
        }

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('total-price-display').textContent = `æ€»è®¡: Â¥${total.toFixed(2)}`;
    }

    // å…³é—­æ¨¡æ€æ¡†
    document.querySelector('.close-btn').addEventListener('click', function() {
        document.getElementById('merchant-detail-modal').style.display = 'none';
    });

    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    window.addEventListener('click', function(e) {
        const modal = document.getElementById('merchant-detail-modal');
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    // ä¸‹å•åŠŸèƒ½
    document.getElementById('place-order-btn').addEventListener('click', function() {
        const selectedMeals = [];

        // è·å–é€‰ä¸­çš„é¤å“
        document.querySelectorAll('.meal-checkbox:checked').forEach(checkbox => {
            const mealId = checkbox.getAttribute('data-meal-id');
            const quantityInput = document.querySelector(`.quantity-input[data-meal-id="${mealId}"]`);
            const quantity = parseInt(quantityInput.value) || 1;

            selectedMeals.push({
                meal_id: mealId,
                quantity: quantity
            });
        });

        if (selectedMeals.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¤å“');
            return;
        }

        // è·å–å•†å®¶å’Œå¹³å°ä¿¡æ¯
        const merchantName = document.getElementById('detail-merchant-name').textContent;
        const platformName = document.getElementById('detail-merchant-platform').textContent;

        // è®¡ç®—æ€»ä»·
        const totalPrice = parseFloat(document.getElementById('total-price-display').textContent.replace('æ€»è®¡: Â¥', ''));

        console.log(`ä¸‹å•æ•°æ®: merchant_id=${currentMerchantId}, platform_id=${currentPlatformId}, meals=`, selectedMeals);

        if (confirm(`ç¡®è®¤å‘ ${merchantName} (${platformName}) ä¸‹å•å—ï¼Ÿæ€»é‡‘é¢: Â¥${totalPrice.toFixed(2)}`)) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btn = this;
            const originalText = btn.textContent;
            btn.textContent = 'ä¸‹å•ä¸­...';
            btn.disabled = true;

            // è·å– CSRF token
            const csrfToken = getCSRFToken();

            // å‘é€ä¸‹å•è¯·æ±‚
            fetch('/customer/place-order/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    merchant_id: currentMerchantId,
                    platform_id: currentPlatformId,
                    meals: selectedMeals,
                    discount_id: selectedDiscount.id,
                    total_price: totalPrice
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ä¸‹å•æˆåŠŸï¼');
                    document.getElementById('merchant-detail-modal').style.display = 'none';
                    // åˆ·æ–°è®¢å•åˆ—è¡¨
                    loadOrders();
                } else {
                    alert('ä¸‹å•å¤±è´¥: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            })
            .finally(() => {
                btn.textContent = originalText;
                btn.disabled = false;
            });
        }
    });

    // æœç´¢ç­›é€‰åŠŸèƒ½
    function setupSearchFilters() {
        const filters = ['platform-filter', 'merchant-filter', 'meal-filter', 'meal-type-filter'];

        filters.forEach(filterId => {
            document.getElementById(filterId).addEventListener('input', function() {
                // ä½¿ç”¨é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                clearTimeout(window.searchTimeout);
                window.searchTimeout = setTimeout(() => {
                    searchMerchants();
                }, 300);
            });
        });
    }

    // æœç´¢å•†å®¶ - è°ƒç”¨åç«¯API
    function searchMerchants() {
        const platformFilter = document.getElementById('platform-filter').value;
        const merchantFilter = document.getElementById('merchant-filter').value;
        const mealFilter = document.getElementById('meal-filter').value;
        const mealTypeFilter = document.getElementById('meal-type-filter').value;

        // æ„å»ºæŸ¥è¯¢å‚æ•°
        const params = new URLSearchParams();
        if (platformFilter) params.append('platform_id', platformFilter);
        if (merchantFilter) params.append('merchant_name', merchantFilter);
        if (mealFilter) params.append('meal_name', mealFilter);
        if (mealTypeFilter) params.append('meal_type', mealTypeFilter);

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        const container = document.getElementById('merchant-cards-container');
        container.innerHTML = '<div style="text-align: center; color: #8b949e; padding: 40px;">æœç´¢ä¸­...</div>';

        // è°ƒç”¨æœç´¢API
        fetch(`/customer/search-merchants/?${params}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateMerchantCards(data.merchants);
                } else {
                    container.innerHTML = '<div style="text-align: center; color: #f85149; padding: 40px;">æœç´¢å¤±è´¥: ' + data.message + '</div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                container.innerHTML = '<div style="text-align: center; color: #f85149; padding: 40px;">ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•</div>';
            });
    }

    // æ›´æ–°å•†å®¶å¡ç‰‡æ˜¾ç¤º
    function updateMerchantCards(merchants) {
        const container = document.getElementById('merchant-cards-container');

        if (merchants.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: #8b949e; padding: 40px;">æš‚æ— å•†å®¶ä¿¡æ¯</div>';
            return;
        }

        let html = '';
        merchants.forEach(merchantData => {
            const merchant = merchantData.merchant;
            const platformsWithMeals = merchantData.platforms_with_meals;

            // æ”¶é›†æ‰€æœ‰å¹³å°ç”¨äºæ˜¾ç¤ºæ ‡ç­¾
            const allPlatforms = platformsWithMeals.map(p => p.platform);

            html += `
                <div class="merchant-card">
                    <div class="merchant-header">
                        <div class="merchant-name">${merchant.merchant_name}</div>
                        <div class="merchant-platforms">
                            ${allPlatforms.map(platform =>
                                `<span class="platform-tag">${platform.platform_name}</span>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="merchant-info-details">
                        <div class="merchant-phone">ç”µè¯: ${merchant.phone}</div>
                        <div class="merchant-address">åœ°å€: ${merchant.address}</div>
                    </div>

                    <div class="merchant-platforms-list">
                        ${platformsWithMeals.map(platformData => `
                            <div class="merchant-platform-item"
                                 data-merchant-id="${merchant.id}"
                                 data-platform-id="${platformData.platform.id}">
                                <div class="platform-header">
                                    <div class="platform-name">${platformData.platform.platform_name}</div>
                                    <div class="platform-meal-count">${platformData.meals_count} ä¸ªé¤å“</div>
                                </div>
                                <div class="merchant-meals">
                                    ${platformData.meals.slice(0, 2).map(meal => `
                                        <div class="meal-item">
                                            <span class="meal-name">${meal.name} <span class="meal-type">${getMealTypeDisplay(meal.meal_type)}</span></span>
                                            <span class="meal-price">Â¥${meal.price}</span>
                                        </div>
                                    `).join('')}
                                    ${platformData.meals.length > 2 ? `
                                        <div style="text-align: center; color: #8b949e; font-size: 12px; margin-top: 4px;">
                                            è¿˜æœ‰ ${platformData.meals.length - 2} ä¸ªé¤å“...
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    // åŠ è½½è®¢å•åˆ—è¡¨
    function loadOrders() {
        fetch('/customer/get-orders/')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateOrdersTable(data.orders);
                }
            })
            .catch(error => {
                console.error('Error loading orders:', error);
            });
    }

    // æ›´æ–°è®¢å•è¡¨æ ¼
    function updateOrdersTable(orders) {
        const tableBody = document.getElementById('orders-table-body');

        if (orders.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="10" style="text-align: center;">æš‚æ— è®¢å•è®°å½•</td></tr>';
            return;
        }

        let html = '';
        orders.forEach(order => {
            const statusClass = `status-${order.status}`;
            const statusDisplay = getStatusDisplay(order.status);
            const discountDisplay = order.discount_id ? `${order.discount_rate}%` : 'æ— ';
            const riderDisplay = order.rider_name || '-';

            // æ ¹æ®è®¢å•çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„æ“ä½œæŒ‰é’®
            let actionButton = '';
            if (order.status === 'ready') {
                // å¾…å–é¤çŠ¶æ€æ˜¾ç¤ºå–é¤æŒ‰é’®
                actionButton = `<button class="btn btn-success pickup-order-btn" data-order-id="${order.id}">å–é¤</button>`;
            } else if (order.status === 'unassigned' || order.status === 'cancelled') {
                // æœªåˆ†é…æˆ–å·²å–æ¶ˆçŠ¶æ€æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
                actionButton = `<button class="btn btn-danger delete-order-btn" data-order-id="${order.id}">åˆ é™¤</button>`;
            } else {
                // å…¶ä»–çŠ¶æ€æ˜¾ç¤ºä¸å¯æ“ä½œ
                actionButton = '<span style="color: #8b949e; font-size: 12px;">ä¸å¯æ“ä½œ</span>';
            }

            html += `
                <tr data-order-id="${order.id}">
                    <td>#${order.id}</td>
                    <td>${order.merchant_name}</td>
                    <td>${order.platform_name}</td>
                    <td>${order.meal_name}</td>
                    <td>Â¥${order.price}</td>
                    <td>${discountDisplay}</td>
                    <td>${riderDisplay}</td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusDisplay}</span>
                    </td>
                    <td>${order.created_at}</td>
                    <td>${actionButton}</td>
                </tr>
            `;
        });

        tableBody.innerHTML = html;
    }

    // è·å–çŠ¶æ€æ˜¾ç¤ºæ–‡æœ¬
    function getStatusDisplay(status) {
        const statusMap = {
            'unassigned': 'æœªåˆ†é…éª‘æ‰‹',
            'assigned': 'å·²åˆ†é…éª‘æ‰‹',
            'ready': 'é¡¾å®¢å¾…å–é¤',
            'completed': 'å·²å®Œæˆ',
            'cancelled': 'å·²å–æ¶ˆ'
        };
        return statusMap[status] || status;
    }

    // åˆ é™¤è®¢å•åŠŸèƒ½
    function setupDeleteOrderHandlers() {
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-order-btn')) {
                const orderId = e.target.getAttribute('data-order-id');
                deleteOrder(orderId);
            }
        });
    }

    // åˆ é™¤è®¢å•
    function deleteOrder(orderId) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
            return;
        }

        // è·å– CSRF token
        const csrfToken = getCSRFToken();

        // å‘é€åˆ é™¤è¯·æ±‚
        fetch(`/customer/delete-order/${orderId}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('è®¢å•åˆ é™¤æˆåŠŸ');
                // ä»è¡¨æ ¼ä¸­ç§»é™¤è¯¥è¡Œ
                const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
                if (row) {
                    row.remove();
                }
                // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨ä»¥ç¡®ä¿æ•°æ®åŒæ­¥
                loadOrders();
            } else {
                alert('åˆ é™¤å¤±è´¥: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
        });
    }

    // å–é¤åŠŸèƒ½
    function setupPickupOrderHandlers() {
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('pickup-order-btn')) {
                const orderId = e.target.getAttribute('data-order-id');
                pickupOrder(orderId);
            }
        });
    }

    // å–é¤æ“ä½œ
    function pickupOrder(orderId) {
        if (!confirm('ç¡®å®šè¦å–é¤å—ï¼Ÿå–é¤åè®¢å•å°†è¢«åˆ é™¤ã€‚')) {
            return;
        }

        // è·å– CSRF token
        const csrfToken = getCSRFToken();

        // å‘é€å–é¤è¯·æ±‚
        fetch(`/customer/pickup-order/${orderId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('å–é¤æˆåŠŸï¼è®¢å•å·²åˆ é™¤ã€‚');
                // ä»è¡¨æ ¼ä¸­ç§»é™¤è¯¥è¡Œ
                const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
                if (row) {
                    row.remove();
                }
                // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨ä»¥ç¡®ä¿æ•°æ®åŒæ­¥
                loadOrders();
            } else {
                alert('å–é¤å¤±è´¥: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
        });
    }

    // é€€å‡ºç™»å½•
    document.querySelector('.logout-btn').addEventListener('click', function() {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            window.location.href = '/login/';
        }
    });

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        setupSearchFilters();
        loadOrders();
        setupDeleteOrderHandlers();
        setupPickupOrderHandlers();
    });
    </script>
</body>
</html>